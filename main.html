<!DOCTYPE html>
<html>
<head>
  <title>Egg Hunt 2018 Segment Calculator</title>
<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

p {
  color: #f2f2f2;
  text-decoration: none;
  font-size: 17px;
}

h1 {
  text-align: center;
}

a:hover {
  background-color: #ddd;
  color: black;
}

a.active {
  background-color: #04AA6D;
  color: white;
}
</style>
  <script>
  // code stolen from https://slashinfty.github.io/yt-frame-timer/main.js :D
var computeClicks = 1;

function compute() {

	computeClicks += 1;
    
    // Initiate basic time variables
    let hours = 0;
    let minutes = 0;
    let seconds = 0;
    let milliseconds = 0;

    // Get framerate, start frame, and end frame from corresponding elements
    // Double check they all have a value
    let frameRate = parseInt(document.getElementById('framerate').value);
    let startFrame = document.getElementById('startobj').value;
    let endFrame = document.getElementById('endobj').value;
    if (typeof (startFrame) === 'undefined' || endFrame === 'undefined' || framerate === 'undefined') {
        return
    };

    // Calculate framerate
    let frames = (endFrame - startFrame) * frameRate;
    seconds = Math.floor(frames / frameRate);
    frames = frames % frameRate;
    milliseconds = Math.round(frames / frameRate * 1000);
    baseTime = milliseconds + (seconds * 1000);
    if (milliseconds < 10) {
        milliseconds = '00' + milliseconds;
    } else if (milliseconds < 100) {
        milliseconds = '0' + milliseconds;
    }
    if (seconds >= 60) {
        minutes = Math.floor(seconds / 60);
        seconds = seconds % 60;
        seconds = seconds < 10 ? '0' + seconds : seconds;
    }
    if (minutes >= 60) {
        hours = Math.floor(minutes / 60);
        minutes = minutes % 60;
        minutes = minutes < 10 ? '0' + minutes : minutes;
    }
    
    // Show the time and mod message in the DOM
    let finalTime = hours.toString() + 'h ' + minutes.toString() + 'm ' + seconds.toString() + 's ' + milliseconds.toString() + 'ms';
    let modMessage = `Mod Message: Time starts at ${parseFloat(startFrame).toFixed(3)} and ends at ${parseFloat(endFrame).toFixed(3)} at ${frameRate} fps to get a final time of ${finalTime}.`;
    let credits = `Retimed using [yt-frame-timer](https://slashinfty.github.io/yt-frame-timer)`;
    document.getElementById('time').value = finalTime;
    document.getElementById('modMessage').disabled = false;
    document.getElementById('modMessage').innerText = modMessage + ' ' + credits;    
    document.getElementById("modMessageButton").disabled = false;
    
    if (computeClicks == 1) {
    	document.getElementById('time1').value = baseTime;
    } else if (computeClicks == 2) {
    	document.getElementById('time2').value = baseTime;
    } else if (computeClicks == 3) {
    	document.getElementById('time3').value = baseTime;
    } else if (computeClicks == 4) {
    	document.getElementById('time4').value = baseTime;
    } else if (computeClicks == 5) {
    	document.getElementById('time5').value = baseTime;
    } else if (computeClicks == 6) {
    	document.getElementById('time6').value = baseTime;
    } else if (computeClicks == 7) {
    	document.getElementById('time7').value = baseTime;
    } else if (computeClicks == 8) {
    	document.getElementById('time8').value = baseTime;
    } else if (computeClicks == 9) {
    	document.getElementById('time9').value = baseTime;
    } else if (computeClicks == 10) {
    	document.getElementById('time10').value = baseTime;
    } else if (computeClicks == 11) {
    	document.getElementById('time11').value = baseTime;
    } else if (computeClicks == 12) {
    	document.getElementById('time12').value = baseTime;
    } else if (computeClicks == 13) {
    	document.getElementById('time13').value = baseTime;
    } else if (computeClicks == 14) {
    	document.getElementById('time14').value = baseTime;
    } else if (computeClicks == 15) {
    	document.getElementById('time15').value = baseTime;
    }
}

function copyModMessage() {
	// Allow user to copy mod message to clipboard
	const textArea = document.getElementById('modMessage');
	textArea.focus();
	textArea.select();
	document.execCommand('copy');
	alert(`The mod message has been copied to clipboard! Please paste it into the comment of the run you are verifying.`);
}

function summationCalculation() {
	let a = Number(document.getElementById("time2").value);
	let b = Number(document.getElementById("time3").value);
    let c = Number(document.getElementById("time4").value);
	let d = Number(document.getElementById("time5").value);
    let e = Number(document.getElementById("time6").value);
	let f = Number(document.getElementById("time7").value);
    let g = Number(document.getElementById("time8").value);
	let h = Number(document.getElementById("time9").value);
    let i = Number(document.getElementById("time10").value);
    let j = Number(document.getElementById("time11").value);
    let k = Number(document.getElementById("time12").value);
    let l = Number(document.getElementById("time13").value);
    let m = Number(document.getElementById("time14").value);
    let n = Number(document.getElementById("time15").value);
  	let totalTimeInMS = a + b + c + d + e + f + g + h + i + j + k + l + m + n;

    let totalTimeInSeconds = Math.floor(totalTimeInMS / 1000);
    let totalTimeInMinutes = Math.floor(totalTimeInSeconds / 60);
    let totalTimeInHours = Math.floor(totalTimeInMinutes / 60);
    
    totalTimeInMS = totalTimeInMS % 1000;
    
    if (totalTimeInMS < 10) {
        totalTimeInMS = '00' + totalTimeInMS;
    } else if (totalTimeInMS < 100) {
        totalTimeInMS = '0' + totalTimeInMS;
    }
    
    totalTimeInSeconds = totalTimeInSeconds % 60;
    if (totalTimeInSeconds < 10) {
    	totalTimeInSeconds = '0' + totalTimeInSeconds;
    }
    
    totalTimeInMinutes = totalTimeInMinutes % 60;
    if (totalTimeInMinutes < 10) {
    	totalTimeInMinutes = '0' + totalTimeInMinutes;
    }
    
    let totalFinalTime = totalTimeInHours.toString() + 'h ' + totalTimeInMinutes.toString() + 'm ' + totalTimeInSeconds.toString() + 's ' + totalTimeInMS.toString() + 'ms';
    /*
    if (milliseconds < 10) {
        milliseconds = '00' + milliseconds;
    } else if (milliseconds < 100) {
        milliseconds = '0' + milliseconds;
    }
    if (seconds >= 60) {
        minutes = Math.floor(seconds / 60);
        seconds = seconds % 60;
        seconds = seconds < 10 ? '0' + seconds : seconds;
    }
    if (minutes >= 60) {
        hours = Math.floor(minutes / 60);
        minutes = minutes % 60;
        minutes = minutes < 10 ? '0' + minutes : minutes;
    }
    */
	document.getElementById("timeTotal").value = totalFinalTime;
}

const validateFPS = (event) => {
    // If framerate is invalid, show an error message and disable start and end frame fields
    if (event.target.value === '' || parseInt(event.target.value) <= 0 || isNaN(parseInt(event.target.value))) {
        document.getElementById('framerate').setCustomValidity('Please enter a valid framerate.');
        document.getElementById('framerate').reportValidity();
        document.getElementById('startobj').disabled = true;
        document.getElementById('endobj').disabled = true;
        document.getElementById('computeButton').disabled = true;
    } else {
        document.getElementById('startobj').disabled = false;
        document.getElementById('endobj').disabled = false;
        document.getElementById('computeButton').disabled = false;
    }
}

const parseForTime = (event) => {
    // Get current frame from input field (either start time or end time)
    let frameFromInputText = (JSON.parse(event.target.value)).lct;
    if (typeof frameFromInputText !== 'undefined') {
        // Get the framerate
        let frameRate = parseInt(document.getElementById('framerate').value);
        // Calculate the frame
        let frameFromObj = (time, fps) => Math.floor(time * fps) / fps; //round to the nearest frame
        let finalFrame = frameFromObj(frameFromInputText, frameRate);
        // Update the DOM
        document.getElementById(event.target.id).value = `${finalFrame}`;
    }
}

function clearActions() {
document.getElementById("time2").value = "";
document.getElementById("time3").value = "";
document.getElementById("time4").value = "";
document.getElementById("time5").value = "";
document.getElementById("time6").value = "";
document.getElementById("time7").value = "";
document.getElementById("time8").value = "";
document.getElementById("time9").value = "";
document.getElementById("time10").value = "";
document.getElementById("time11").value = "";
document.getElementById("time12").value = "";
document.getElementById("time13").value = "";
document.getElementById("time14").value = "";
document.getElementById("time15").value = "";
computeClicks = 1;
}
  
  
  
  
  
  
  
  
  
  
  
  
  
  </script>
</head>
<body>

    <h1 id="youtube-interval-timer">Egg Hunt 2018 Segment Calculator</h1>
    <h3 id="video-framerate">Video Framerate</h3>
    <p>Right click the YouTube video and select “Stats for nerds.” The third line is “Current / Optimal Res” - find the
      two numbers after the @ and enter them for framerate.</p>
    <p>
      <label for="framerate">Framerate: </label>
      <input type="text" id="framerate" size="3" value="30" onchange='validateFPS(event)' />
    </p>
    <h3 id="video-endpoints">Video Endpoints</h3>
    <p>
      Find the starting point (you can use the <code>,</code> and <code>.</code> keys to find the exact frame). Right
      click the video and select “Copy debug info” and paste it for starting frame. Repeat for ending frame.
    </p>
    <p>
      <label for="startobj">Starting frame: </label>
      <input type="text" id="startobj" style='width:100%' size="100" onchange='parseForTime(event)' />
    </p>
    <p>
      <label for="endobj">Ending frame: </label>
      <input type="text" id="endobj" style='width:100%' size="100" onchange='parseForTime(event)' />
    </p>
    <h3 id="video-time">Video Time</h3>
    <button id="computeButton" onclick="compute()">Compute time</button>&nbsp;<input type="text" id="time" readonly
      size="20" />
  <br />
  <h3> Action History (In Milliseconds)</h3>
  <p>All computed times will go here. Summing them up with the button will add the times you computed and deliver them to you in proper format.</p>
  <input type="text" id="time2" size="20" />
    <br />
  <input type="text" id="time3" size="20" />
    <br />
  <input type="text" id="time4" size="20" />
    <br />
  <input type="text" id="time5" size="20" />
    <br />
  <input type="text" id="time6" size="20" />
    <br />
  <input type="text" id="time7" size="20" />
    <br />
  <input type="text" id="time8" size="20" />
    <br />
  <input type="text" id="time9" size="20" />
    <br />
  <input type="text" id="time10" size="20" />
    <br />
  <input type="text" id="time11" size="20" />
    <br />
  <input type="text" id="time12" size="20" />
    <br />
  <input type="text" id="time13" size="20" />
    <br />
  <input type="text" id="time14" size="20" />
    <br />
  <input type="text" id="time15" size="20" />
    <br />
    <br />
      <button id="summationCalculationButton" onclick="summationCalculation()" >Sum 'em up!</button>
      <button id="clearActionsButton" onclick="clearActions()" >Clear</button>
      
      
      
  	<p>
		<label for="time">Total Time: </label>
		<input type="text" id="timeTotal" class="own_line" readonly>
	</p>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />
        <h3 id="about">About</h3>
    <p>Takes start and stop points of a YouTube video, down to the frame, and gives the time between them in the format
      <code>1h 23m 45s 678ms</code>. Source code is <a
        href="https://github.com/aaa-321/egghunttimer/tree/main">available</a>. Original code from <a href="https://github.com/slashinfty/yt-frame-timer">here.</a>
    </p>
    <p>
      <textarea id="modMessage" cols="40" rows="5" disabled></textarea>
    </p>
    <button id="modMessageButton" onclick="copyModMessage()" disabled>Copy Mod Message to Clipboard</button>

</body>

</html>

